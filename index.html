<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="favicon.png" />
    <title>Simulador de Puntuación VPO - Herrera</title>
    <style>
      :root {
        --verde-principal: #007a33;
        --verde-claro: #e6f4ea;
        --gris-claro: #f5f5f5;
        --gris-medio: #e0e0e0;
        --texto-oscuro: #333333;
        --texto-medio: #666666;
        --blanco: #ffffff;
        --rojo-bajo: #dc3545;
        --amarillo-medio: #ffc107;
        --verde-alto: #28a745;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--gris-claro);
        color: var(--texto-oscuro);
        line-height: 1.6;
      }

      

      /* Header principal - MEJORADO */
      .main-header {
        background-color: var(--verde-principal);
        color: var(--blanco);
        padding: 12px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo-container {
        display: flex;
        align-items: center;
      }

      .logo {
        height: 50px;
        margin-right: 15px;
      }

      .header-titles {
        display: flex;
        flex-direction: column;
      }

      .header-title {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1.2;
        margin-bottom: 2px;
      }

      .header-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
        line-height: 1.2;
      }

      /* Navegación - MEJORADA */
      .nav-menu {
        display: flex;
        list-style: none;
      }

      .nav-item {
        margin-left: 16px;
        position: relative;
      }

      .nav-link {
        color: var(--blanco);
        text-decoration: none;
        font-weight: 500;
        padding: 10px 12px;
        border-radius: 4px;
        transition: background-color 0.3s;
        font-size: 0.95rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        min-height: 60px;
        justify-content: center;
        min-width: 70px;
      }

      .nav-link span {
        display: block;
        line-height: 1.2;
      }

      .nav-link .nav-text {
        margin-top: 4px;
        font-size: 0.8rem;
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: rgba(255, 255, 255, 0.15);
      }

      .dropdown {
        position: relative;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: var(--blanco);
        min-width: 280px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        z-index: 1;
        top: 100%;
        left: 0;
      }

      .dropdown-content a {
        color: var(--texto-oscuro);
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        border-bottom: 1px solid var(--gris-medio);
        transition: background-color 0.2s;
        font-size: 0.9rem;
      }

      .dropdown-content a:hover {
        background-color: var(--gris-claro);
      }

      .dropdown-content a i {
        margin-right: 8px;
        color: var(--verde-principal);
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }

      .hamburger {
        display: none;
        flex-direction: column;
        cursor: pointer;
        padding: 5px;
      }

      .hamburger span {
        height: 3px;
        width: 25px;
        background: var(--blanco);
        margin-bottom: 4px;
        border-radius: 5px;
        transition: 0.3s;
      }

      /* Contenido principal */
      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
        position: relative;
      }

      .card {
        background-color: var(--blanco);
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 25px;
        margin-bottom: 20px;
        position: relative;
      }

      /* Mensaje de construcción sutil */
      .construccion-mensaje {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 193, 7, 0.9);
        color: #856404;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 8px;
        animation: pulse 2s infinite;
        border: 1px solid rgba(255, 193, 7, 0.5);
      }

      .construccion-mensaje i {
        font-size: 0.9rem;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4);
        }

        70% {
          box-shadow: 0 0 0 6px rgba(255, 193, 7, 0);
        }

        100% {
          box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--texto-oscuro);
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--gris-medio);
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus {
        border-color: var(--verde-principal);
        outline: none;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background-color: var(--gris-claro);
        border-radius: 6px;
      }

      .checkbox-group input {
        margin-right: 10px;
        transform: scale(1.2);
      }

      .info-text {
        font-size: 0.85rem;
        color: var(--texto-medio);
        margin-top: 5px;
      }

      .btn-calcular {
        width: 100%;
        padding: 15px;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--blanco);
        background-color: var(--verde-principal);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: 10px;
      }

      .btn-calcular:hover {
        background-color: #006428;
      }

      .resultado {
        margin-top: 25px;
        padding: 20px;
        background-color: var(--verde-claro);
        border: 1px solid var(--verde-principal);
        border-radius: 8px;
        text-align: center;
        display: none;
      }

      .resultado h2 {
        margin-bottom: 15px;
        color: var(--verde-principal);
      }

      .score-display {
        margin: 15px 0;
      }

      .puntos-obtenidos {
        font-size: 3rem;
        font-weight: 700;
        color: var(--verde-principal);
      }

      .score-max {
        font-size: 1.5rem;
        color: var(--texto-medio);
      }

      .mensaje-probabilidad {
        font-size: 1.2rem;
        font-weight: 600;
        margin-top: 15px;
        padding: 10px;
        border-radius: 6px;
      }

      .alta {
        background-color: var(--verde-claro);
        color: var(--verde-alto);
      }

      .media {
        background-color: #fff3cd;
        color: var(--amarillo-medio);
      }

      .baja {
        background-color: #f8d7da;
        color: var(--rojo-bajo);
      }

      .info-section {
        margin-top: 30px;
      }

      .info-section h3 {
        color: var(--verde-principal);
        margin-bottom: 15px;
        border-bottom: 1px solid var(--gris-medio);
        padding-bottom: 8px;
      }

      .cupos-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }

      .cupos-table th,
      .cupos-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid var(--gris-medio);
      }

      .cupos-table th {
        background-color: var(--gris-claro);
        font-weight: 600;
      }

      .cupos-table tr:hover {
        background-color: var(--gris-claro);
      }

      /* Control de visibilidad de secciones - VERSIÓN CORREGIDA */
[id^="seccion-"] {
    display: none;
}

.seccion-activa {
    display: block !important;
}

/* Excepción: el simulador visible por defecto SOLO cuando es activo */
#seccion-simulador.seccion-activa {
    display: block;
}

      .explicacion-cupos {
        margin: 20px 0;
        padding: 15px;
        background-color: var(--verde-claro);
        border-radius: 8px;
        border-left: 4px solid var(--verde-principal);
      }

      .documentos-legales {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .documento-card {
        background-color: var(--gris-claro);
        border-radius: 8px;
        padding: 20px;
        border-left: 4px solid var(--verde-principal);
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
      }

      .documento-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .documento-card h3 {
        color: var(--verde-principal);
        margin-bottom: 10px;
      }

      .documento-card p {
        color: var(--texto-medio);
        margin-bottom: 15px;
        font-size: 0.9rem;
      }

      .btn-documento {
        display: inline-block;
        background-color: var(--verde-principal);
        color: var(--blanco);
        padding: 8px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.3s;
      }

      .btn-documento:hover {
        background-color: #006428;
      }

      .contacto-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-top: 30px;
      }

      .contacto-card {
        background-color: var(--gris-claro);
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        border-left: 4px solid var(--verde-principal);
        position: relative;
      }

      .contacto-card i {
        font-size: 2.5rem;
        color: var(--verde-principal);
        margin-bottom: 15px;
      }

      .contacto-card h3 {
        color: var(--verde-principal);
        margin-bottom: 15px;
      }

      .contacto-card p {
        margin-bottom: 10px;
        color: var(--texto-medio);
      }

      .contacto-enlace {
        display: inline-block;
        margin-top: 10px;
        color: var(--verde-principal);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }

      .contacto-enlace:hover {
        color: #006428;
        text-decoration: underline;
      }

      /* Estilos para la sección de posición en cupos */
      .cupo-posicion {
        margin-top: 20px;
        padding: 15px;
        background-color: var(--gris-claro);
        border-radius: 8px;
        border-left: 4px solid var(--verde-principal);
      }

      .cupo-posicion h3 {
        color: var(--verde-principal);
        margin-bottom: 10px;
      }

      .posicion-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid var(--gris-medio);
      }

      .posicion-item:last-child {
        border-bottom: none;
      }

      .posicion-cupo {
        font-weight: 600;
      }

      .posicion-datos {
        text-align: right;
      }

      .posicion-puntos {
        font-weight: 600;
        color: var(--verde-principal);
      }

      .posicion-numero {
        font-size: 0.85rem;
        color: var(--texto-medio);
      }

      /* Estilos para Preguntas Frecuentes */
      .faq-category {
        margin-bottom: 30px;
      }

      .faq-category h3 {
        color: var(--verde-principal);
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--verde-principal);
      }

      .faq-item {
        margin-bottom: 15px;
        border: 1px solid var(--gris-medio);
        border-radius: 6px;
        overflow: hidden;
      }

      .faq-question {
        background-color: var(--gris-claro);
        padding: 15px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s;
      }

      .faq-question:hover {
        background-color: var(--gris-medio);
      }

      .faq-question i {
        transition: transform 0.3s;
      }

      .faq-answer {
        padding: 0 15px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
      }

      .faq-item.active .faq-answer {
        padding: 15px;
        max-height: 500px;
      }

      .faq-item.active .faq-question i {
        transform: rotate(180deg);
      }

      /* Estilos para la sección de Consulta de Puntuaciones */
      .consulta-cupo {
        margin-bottom: 30px;
      }

      .consulta-cupo h3 {
        color: var(--verde-principal);
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--verde-principal);
      }

      .solicitante-list {
        border: 1px solid var(--gris-medio);
        border-radius: 6px;
        overflow: hidden;
      }

      .solicitante-header {
        background-color: var(--verde-principal);
        color: var(--blanco);
        padding: 12px 15px;
        font-weight: 600;
        display: grid;
        grid-template-columns: 100px 1fr 100px;
        gap: 15px;
      }

      .solicitante-item {
        padding: 12px 15px;
        display: grid;
        grid-template-columns: 100px 1fr 100px;
        gap: 15px;
        border-bottom: 1px solid var(--gris-medio);
        transition: background-color 0.2s;
      }

      .solicitante-item:last-child {
        border-bottom: none;
      }

      .solicitante-item:hover {
        background-color: var(--gris-claro);
      }

      .solicitante-numero {
        font-weight: 600;
        color: var(--verde-principal);
      }

      .solicitante-puntos {
        font-weight: 600;
        text-align: right;
      }

      .solicitante-usuario {
        background-color: var(--verde-claro);
        font-weight: 600;
      }

      .viviendas-disponibles {
        margin-top: 10px;
        font-size: 0.9rem;
        color: var(--texto-medio);
        font-style: italic;
      }

      /* Advertencia sobre carácter orientativo */
      .advertencia-consulta {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 25px;
        border-left: 4px solid var(--amarillo-medio);
      }

      .advertencia-consulta h4 {
        color: #856404;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .advertencia-consulta p {
        color: #856404;
        font-size: 0.9rem;
        margin: 0;
      }

      .advertencia-consulta ul {
        margin: 10px 0 0 20px;
        color: #856404;
        font-size: 0.85rem;
      }

      footer {
        text-align: center;
        margin-top: 30px;
        padding: 15px;
        color: var(--texto-medio);
        font-size: 0.9rem;
        background-color: var(--gris-claro);
        border-top: 1px solid var(--gris-medio);
      }

      /* Mejoras adicionales */
      .input-error {
        border-color: var(--rojo-bajo) !important;
        background-color: #fff5f5;
      }

      .error-message {
        color: var(--rojo-bajo);
        font-size: 0.8rem;
        margin-top: 5px;
        display: none;
      }

      .form-group.required label::after {
        content: " *";
        color: var(--rojo-bajo);
      }

      .loading-indicator {
        display: none;
        text-align: center;
        padding: 10px;
      }

      .loading-indicator i {
        color: var(--verde-principal);
        margin-right: 8px;
      }

      .btn-secundario {
        display: inline-block;
        background-color: var(--gris-medio);
        color: var(--texto-oscuro);
        padding: 10px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.3s;
        border: none;
        cursor: pointer;
        margin-top: 10px;
      }

      .btn-secundario:hover {
        background-color: #d0d0d0;
      }

      /* Responsive - MEJORADO */
      @media (max-width: 1024px) {
        .nav-link {
          font-size: 0.9rem;
          padding: 8px 10px;
          min-width: 65px;
        }

        .nav-link .nav-text {
          font-size: 0.75rem;
        }

        .nav-item {
          margin-left: 12px;
        }
      }

      @media (max-width: 900px) {
        .nav-menu {
          display: none;
        }

        .hamburger {
          display: flex;
        }

        .nav-menu.active {
          display: flex;
          flex-direction: column;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background-color: var(--verde-principal);
          padding: 15px;
          box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-menu.active .nav-item {
          margin: 5px 0;
          width: 100%;
        }

        .nav-menu.active .nav-link {
          flex-direction: row;
          justify-content: flex-start;
          min-height: auto;
          padding: 12px 15px;
          text-align: left;
        }

        .nav-menu.active .nav-text {
          margin-top: 0;
          margin-left: 8px;
          font-size: 0.9rem;
        }

        .dropdown-content {
          position: static;
          box-shadow: none;
          margin-top: 5px;
          width: 100%;
        }

        .construccion-mensaje {
          top: 10px;
          right: 10px;
          font-size: 0.75rem;
          padding: 6px 12px;
        }

        .solicitante-header,
        .solicitante-item {
          grid-template-columns: 80px 1fr 80px;
          gap: 10px;
        }
      }

      @media (max-width: 768px) {
        .header-container {
          flex-wrap: wrap;
        }

        .container {
          padding: 0 15px;
        }

        .card {
          padding: 15px;
        }

        .puntos-obtenidos {
          font-size: 2.5rem;
        }

        .documentos-legales {
          grid-template-columns: 1fr;
        }

        .contacto-info {
          grid-template-columns: 1fr;
        }

        .header-title {
          font-size: 1.2rem;
        }

        .header-subtitle {
          font-size: 0.8rem;
        }

        .logo {
          height: 45px;
        }

        .posicion-item {
          flex-direction: column;
        }

        .posicion-datos {
          text-align: left;
          margin-top: 5px;
        }

        .solicitante-header,
        .solicitante-item {
          grid-template-columns: 70px 1fr 70px;
          font-size: 0.9rem;
        }
      }

      @media (max-width: 480px) {
        .header-title {
          font-size: 1.1rem;
        }

        .logo {
          height: 40px;
        }

        .construccion-mensaje {
          position: relative;
          top: 0;
          right: 0;
          margin-bottom: 15px;
          text-align: center;
          justify-content: center;
        }

        .solicitante-header,
        .solicitante-item {
          grid-template-columns: 60px 1fr 60px;
          font-size: 0.85rem;
          padding: 10px;
        }
      }

      /* Nuevos estilos para el botón de reinicio */
      .btn-reiniciar {
        width: 100%;
        padding: 12px;
        font-size: 1rem;
        font-weight: 600;
        color: var(--texto-oscuro);
        background-color: var(--gris-medio);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-reiniciar:hover {
        background-color: #d0d0d0;
      }

      .botones-resultado {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .botones-resultado .btn-calcular,
      .botones-resultado .btn-reiniciar {
        flex: 1;
        margin-top: 0;
      }

      @media (max-width: 768px) {
        .botones-resultado {
          flex-direction: column;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>

  <body>
    <!-- Header principal con navegación - MEJORADO -->
    <header class="main-header">
      <div class="header-container">
        <div class="logo-container">
          <img src="favicon.png" alt="AxSí Herrera" class="logo" />
          <div class="header-titles">
            <div class="header-title">Simulador de Vivienda Protegida</div>
            <div class="header-subtitle">
              Herrera - Transparencia y justicia social
            </div>
          </div>
        </div>

        <div class="hamburger" id="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>

        <ul class="nav-menu" id="navMenu">
          <li class="nav-item">
            <a
              href="#simulador"
              class="nav-link active"
              data-seccion="simulador"
            >
              <i class="fas fa-calculator"></i>
              <span class="nav-text">Simulador</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#consulta" class="nav-link" data-seccion="consulta">
              <i class="fas fa-search"></i>
              <span class="nav-text">Consulta Puntuaciones</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#cupos" class="nav-link" data-seccion="cupos">
              <i class="fas fa-list-alt"></i>
              <span class="nav-text">Cupos</span>
            </a>
          </li>
          <li class="nav-item">
    <a href="#legal" class="nav-link" data-seccion="legal">
        <i class="fas fa-gavel"></i>
        <span class="nav-text">Legal</span>
    </a>
</li>
          <li class="nav-item">
            <a href="#faq" class="nav-link" data-seccion="faq">
              <i class="fas fa-question-circle"></i>
              <span class="nav-text">Preguntas Frecuentes</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#contacto" class="nav-link" data-seccion="contacto">
              <i class="fas fa-envelope"></i>
              <span class="nav-text">Contacto</span>
            </a>
          </li>
        </ul>
      </div>
    </header>

    <div class="container">
      <!-- Sección del simulador (activa por defecto) -->
      <div id="seccion-simulador" class="seccion-activa">
        <div class="card">
          <div class="construccion-mensaje">
            <i class="fas fa-tools"></i>
            Página en construcción
          </div>
          <h2 id="simulador">Calcula tu puntuación</h2>
          <p style="margin-bottom: 20px; color: var(--texto-medio)">
            Completa los siguientes datos para obtener una estimación de tu
            puntuación en el baremo de adjudicación de viviendas protegidas.
          </p>

          <form id="simulador-form">
            <div class="form-group required">
              <label for="ano_inscripcion"
                >1. Año de inscripción en el Registro</label
              >
              <input
                type="number"
                id="ano_inscripcion"
                placeholder="Ej: 2019"
                min="1990"
                max="2024"
              />
              <div class="error-message" id="error-ano">
                Por favor, introduce un año válido entre 1990 y 2024
              </div>
              <div class="info-text">
                Se asignará 1 punto por cada año completo de antigüedad (máximo
                5 puntos)
              </div>
            </div>

            <div class="form-group required">
              <label for="ingresos_anuales"
                >2. Ingresos familiares anuales (€)</label
              >
              <input
                type="number"
                id="ingresos_anuales"
                placeholder="Ej: 10000"
                step="100"
              />
              <div class="error-message" id="error-ingresos">
                Por favor, introduce una cantidad válida
              </div>
              <div class="info-text">IPREM anual de referencia: 7.200 €</div>
            </div>

            <div class="form-group required">
              <label for="edad">3. Edad del solicitante principal</label>
              <input
                type="number"
                id="edad"
                placeholder="Ej: 33"
                min="18"
                max="100"
              />
              <div class="error-message" id="error-edad">
                La edad debe estar entre 18 y 100 años
              </div>
            </div>

            <div class="form-group">
              <label for="situacion_familiar">4. Situación familiar</label>
              <select id="situacion_familiar">
                <option value="ninguna" selected>
                  Otra situación (0 puntos)
                </option>
                <option value="monoparental">
                  Familia monoparental (3 puntos)
                </option>
                <option value="numerosa">Familia numerosa (3 puntos)</option>
                <option value="solo_progenitor">
                  Un solo progenitor con hijos menores (2 puntos)
                </option>
                <option value="pareja_joven">
                  Pareja joven sin hijos (1 punto)
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="vivienda_actual"
                >5. Situación de la vivienda actual</label
              >
              <select id="vivienda_actual">
                <option value="ninguna" selected>
                  Otra situación (propiedad, cedida, etc.) (0 puntos)
                </option>
                <option value="inadecuada">
                  Vivienda inadecuada, hacinamiento o sin acceso (3 puntos)
                </option>
                <option value="alquiler_caro">
                  Vivienda alquilada (renta > 30% ingresos) (2 puntos)
                </option>
              </select>
            </div>

            <div class="form-group">
              <label
                >6. Situaciones especiales (marque todas las que
                apliquen)</label
              >
              <div class="checkbox-group">
                <input type="checkbox" id="discapacidad" />
                <label for="discapacidad"
                  >Algún miembro con discapacidad (≥33%) o dependencia (3
                  puntos)</label
                >
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="violencia_genero" />
                <label for="violencia_genero"
                  >Víctima de violencia de género o terrorismo (3 puntos)</label
                >
              </div>
            </div>

            <div class="loading-indicator" id="loading-indicator">
              <i class="fas fa-spinner fa-spin"></i> Calculando puntuación...
            </div>

            <button
              type="button"
              class="btn-calcular"
              onclick="calcularPuntos()"
            >
              Calcular mi puntuación
            </button>
          </form>

          <div id="resultado" class="resultado">
            <h2>Tu puntuación orientativa es:</h2>
            <div class="score-display">
              <span id="puntos_obtenidos" class="puntos-obtenidos">0</span>
              <span class="score-max"> / 25 puntos</span>
            </div>
            <p id="mensaje_probabilidad" class="mensaje-probabilidad"></p>

            <!-- Nueva sección de posición en cupos -->
            <div id="cupo-posicion" class="cupo-posicion" style="display: none">
              <h3>Tu posición estimada en los cupos:</h3>
              <div id="lista-posiciones"></div>
            </div>

            <!-- Botones de acción después del cálculo -->
            <div class="botones-resultado">
              <button
                type="button"
                class="btn-calcular"
                onclick="calcularPuntos()"
              >
                Recalcular
              </button>
              <button
                type="button"
                class="btn-reiniciar"
                onclick="reiniciarSimulador()"
              >
                <i class="fas fa-redo"></i> Nuevo Cálculo
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de Consulta de Puntuaciones (solo listados) -->
<div id="seccion-consulta" class="seccion-consulta">
        <div class="card">
          <h2>Consulta de Puntuaciones por Cupo</h2>

          <div class="advertencia-consulta">
            <h4>
              <i class="fas fa-exclamation-triangle"></i> Información importante
            </h4>
            <p>
              Los listados que se muestran a continuación son
              <strong>totalmente orientativos</strong> y tienen únicamente fines
              informativos:
            </p>
            <ul>
              <li>
                Las puntuaciones mostradas son
                <strong>estimaciones</strong> basadas en datos simulados
              </li>
              <li>
                La única puntuación válida es la que resulte de las
                <strong>solicitudes oficialmente presentadas</strong>
              </li>
              <li>
                Las posiciones pueden variar según la documentación aportada y
                validada
              </li>
              <li>
                Los números de solicitud son <strong>anónimos</strong> para
                proteger la privacidad
              </li>
            </ul>
          </div>

          <p style="margin-bottom: 20px; color: var(--texto-medio)">
            Listado de todas las solicitudes ordenadas por puntuación en cada
            cupo de adjudicación.
          </p>

          <!-- Cupo de Discapacidad/Movilidad Reducida -->
          <div class="consulta-cupo">
            <h3>Cupo de Discapacidad/Movilidad Reducida</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 1</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-discapacidad"></div>
            </div>
          </div>

          <!-- Cupo de Jóvenes -->
          <div class="consulta-cupo">
            <h3>Cupo de Jóvenes (&lt;35 años)</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 2</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-jovenes"></div>
            </div>
          </div>

          <!-- Cupo de Familias Numerosas/Monoparentales -->
          <div class="consulta-cupo">
            <h3>Cupo de Familias Numerosas/Monoparentales</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 1-2</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-familias"></div>
            </div>
          </div>

          <!-- Cupo de Mayores de 65 años -->
          <div class="consulta-cupo">
            <h3>Cupo de Mayores de 65 años</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 1</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-mayores"></div>
            </div>
          </div>

          <!-- Cupo de Violencia de Género/Terrorismo -->
          <div class="consulta-cupo">
            <h3>Cupo de Violencia de Género/Terrorismo</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 1</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-violencia"></div>
            </div>
          </div>

          <!-- Cupo de Régimen General -->
          <div class="consulta-cupo">
            <h3>Cupo de Régimen General</h3>
            <div class="viviendas-disponibles">Viviendas disponibles: 8</div>
            <div class="solicitante-list">
              <div class="solicitante-header">
                <div>Nº Solic.</div>
                <div>Solicitud</div>
                <div>Puntos</div>
              </div>
              <div id="lista-general"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de cupos (oculta por defecto) -->
      <div id="seccion-cupos" class="seccion-cupos">
        <div class="card">
          <h2>Cupos de Adjudicación en Herrera</h2>

          <div class="explicacion-cupos">
            <p>
              En Herrera, las viviendas protegidas se adjudican mediante cupos
              específicos para garantizar el acceso a los colectivos con mayores
              necesidades. A continuación se muestra la distribución aproximada
              para 15 viviendas:
            </p>
          </div>

          <table class="cupos-table">
            <thead>
              <tr>
                <th>Cupo</th>
                <th>% reservado</th>
                <th>Viviendas aprox.</th>
                <th>Criterio de ordenación</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Discapacidad/movilidad reducida</td>
                <td>10%</td>
                <td>1 vivienda</td>
                <td>Por puntuación dentro del cupo</td>
              </tr>
              <tr>
                <td>Jóvenes (&lt;35 años)</td>
                <td>15%</td>
                <td>2 viviendas</td>
                <td>Por puntuación dentro del cupo</td>
              </tr>
              <tr>
                <td>Familias numerosas/monoparentales</td>
                <td>10%</td>
                <td>1-2 viviendas</td>
                <td>Por puntuación dentro del cupo</td>
              </tr>
              <tr>
                <td>Mayores de 65 años</td>
                <td>5%</td>
                <td>1 vivienda</td>
                <td>Por puntuación dentro del cupo</td>
              </tr>
              <tr>
                <td>Violencia de género/terrorismo</td>
                <td>5%</td>
                <td>1 vivienda</td>
                <td>Por puntuación dentro del cupo</td>
              </tr>
              <tr>
                <td>Régimen general</td>
                <td>55%</td>
                <td>8 viviendas</td>
                <td>Por puntuación general (todos los inscritos)</td>
              </tr>
            </tbody>
          </table>

          <div class="info-section">
            <h3>¿Cómo funcionan los cupos?</h3>
            <p>
              Cada vecino puede solicitar su vivienda dentro del cupo
              correspondiente a su situación. Si, por ejemplo, hay 25 jóvenes
              inscritos y 2 viviendas para ese cupo, los 2 con mayor puntuación
              total obtendrían la adjudicación y los siguientes quedarían en
              lista de espera.
            </p>

            <h3>¿Puedo solicitar en varios cupos?</h3>
            <p>
              Sí, un solicitante puede estar incluido en varios cupos si cumple
              con los requisitos. Por ejemplo, una persona joven con
              discapacidad podría optar tanto al cupo de jóvenes como al de
              discapacidad.
            </p>

            <h3>¿Qué pasa si no hay suficientes solicitantes en un cupo?</h3>
            <p>
              Si no hay suficientes solicitantes para cubrir un cupo específico,
              las viviendas sobrantes se destinan al cupo de régimen general.
            </p>
          </div>
        </div>
      </div>

      <!-- Sección de información legal (oculta por defecto) -->
      <div id="seccion-legal" class="seccion-legal">
        <div class="card">
          <h2>Marco Legal de Vivienda Protegida en Andalucía</h2>
          <p style="margin-bottom: 20px; color: var(--texto-medio)">
            Consulta toda la normativa aplicable al proceso de adjudicación de
            viviendas protegidas en Herrera.
          </p>

          <div class="documentos-legales">
            <div class="documento-card">
              <h3>Decreto 1/2012</h3>
              <p>
                Regula el Registro de Demandantes de Vivienda Protegida en
                Andalucía y establece el sistema de baremación.
              </p>
              <a
                href="https://www.juntadeandalucia.es/boja/2012/11/1"
                target="_blank"
                class="btn-documento"
                >Consultar decreto</a
              >
            </div>

            <div class="documento-card">
              <h3>Orden 1 de marzo de 2010</h3>
              <p>
                Establece el baremo tipo para la adjudicación de viviendas
                protegidas, aún vigente parcialmente.
              </p>
              <a
                href="https://www.juntadeandalucia.es/boja/2010/45/1"
                target="_blank"
                class="btn-documento"
                >Consultar orden</a
              >
            </div>

            <div class="documento-card">
              <h3>Ordenanza Municipal 2013</h3>
              <p>
                Adopta el baremo autonómico para su aplicación en el municipio
                de Herrera.
              </p>
              <a
                href="https://www.dipusevilla.es/area/urbanismo/vivienda/ordenanzas-municipales"
                target="_blank"
                class="btn-documento"
                >Consultar ordenanza</a
              >
            </div>

            <div class="documento-card">
              <h3>Ley 1/2010</h3>
              <p>
                Ley de Vivienda de Andalucía que establece el marco general de
                la vivienda protegida.
              </p>
              <a
                href="https://www.boe.es/buscar/act.php?id=BOE-A-2010-9279"
                target="_blank"
                class="btn-documento"
                >Consultar ley</a
              >
            </div>
          </div>

          <div class="info-section">
            <h3>Base legal del baremo de adjudicación</h3>
            <p>
              El sistema de puntuación para adjudicar viviendas protegidas está
              regulado por:
            </p>
            <ul style="margin: 15px 0; padding-left: 20px">
              <li>
                <strong>Decreto 1/2012, de 10 de enero</strong>, por el que se
                regula el Registro de Demandantes de Vivienda Protegida en
                Andalucía.
              </li>
              <li>
                <strong>Orden de 1 de marzo de 2010</strong> (vigente
                parcialmente), que establecía el baremo tipo y sigue
                utilizándose como referencia adaptada por los ayuntamientos.
              </li>
              <li>
                Y en el caso de Herrera, la
                <strong>Ordenanza Municipal de 2013</strong>, que adopta ese
                baremo autonómico casi íntegramente.
              </li>
            </ul>
            <p>
              Por tanto, el baremo aplicable en Herrera es el modelo tipo del
              Decreto 1/2012 más las adaptaciones locales de la Ordenanza.
            </p>
          </div>
        </div>
      </div>

     

      <!-- Sección de Preguntas Frecuentes (oculta por defecto) -->
      <div id="seccion-faq" class="seccion-faq">
        <div class="card">
          <div class="construccion-mensaje">
            <i class="fas fa-tools"></i>
            Página en construcción
          </div>
          <h2>Preguntas Frecuentes por Cupo</h2>

          <div class="faq-category">
            <h3>Cupo de Discapacidad/Movilidad Reducida</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Qué documentación necesito para acreditar discapacidad?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Necesitará presentar el certificado de discapacidad emitido
                  por el órgano competente de la Junta de Andalucía, con un
                  grado igual o superior al 33%.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <div class="faq-question">
                ¿Puedo solicitar en este cupo si tengo un familiar con
                discapacidad?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Sí, si un miembro de su unidad familiar tiene reconocido un
                  grado de discapacidad igual o superior al 33%, puede solicitar
                  en este cupo.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h3>Cupo de Jóvenes (&lt;35 años)</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Qué edad máxima tengo que tener para este cupo?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Debe tener menos de 35 años en la fecha de presentación de la
                  solicitud.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <div class="faq-question">
                ¿Puedo solicitar en este cupo si tengo hijos?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Sí, tener hijos no le excluye de este cupo, pero también
                  podría optar al cupo de familias monoparentales si cumple los
                  requisitos.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h3>Cupo de Familias Numerosas/Monoparentales</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Qué se considera familia monoparental?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Se considera familia monoparental aquella formada por un solo
                  progenitor y uno o más hijos menores o mayores discapacitados.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <div class="faq-question">
                ¿Necesito título de familia numerosa para este cupo?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Sí, para el cupo de familias numerosas es necesario acreditar
                  el título oficial de familia numerosa.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h3>Cupo de Mayores de 65 años</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Qué ingresos se tienen en cuenta para este cupo?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Se tienen en cuenta todos los ingresos de la unidad familiar,
                  incluidas pensiones y cualquier otro tipo de renta.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h3>Cupo de Violencia de Género/Terrorismo</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Qué documentación necesito para acreditar esta situación?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Necesitará presentar resolución judicial de protección o
                  informe de los servicios sociales que acredite su situación.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h3>Cupo de Régimen General</h3>

            <div class="faq-item">
              <div class="faq-question">
                ¿Puedo solicitar en varios cupos a la vez?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Sí, si cumple los requisitos para varios cupos, será incluido
                  automáticamente en todos ellos, lo que aumenta sus
                  posibilidades.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <div class="faq-question">
                ¿Cómo se ordenan las solicitudes en el cupo general?
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="faq-answer">
                <p>
                  Las solicitudes se ordenan por puntuación total obtenida en el
                  baremo, de mayor a menor puntuación.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de contacto (oculta por defecto) -->
      <div id="seccion-contacto" class="seccion-contacto">
        <div class="card">
          <h2>Contacto</h2>
          <p style="margin-bottom: 20px; color: var(--texto-medio)">
            Ponte en contacto con nosotros para resolver cualquier duda sobre el
            proceso de adjudicación de viviendas protegidas en Herrera.
          </p>

          <div class="contacto-info">
            <div class="contacto-card">
              <i class="fas fa-phone-alt"></i>
              <h3>Teléfono</h3>
              <p>Disponible para consultas</p>
              <a href="tel:+34654501982" class="contacto-enlace"
                >+34 654 50 19 82</a
              >
            </div>

            <div class="contacto-card">
              <i class="fas fa-envelope"></i>
              <h3>Correo Electrónico</h3>
              <p>Envíanos tus consultas por email</p>
              <a
                href="mailto:andaluciaporsiherrera@gmail.com"
                class="contacto-enlace"
                >andaluciaporsiherrera@gmail.com</a
              >
            </div>

            <div class="contacto-card">
              <i class="fas fa-map-marker-alt"></i>
              <h3>Ayuntamiento de Herrera</h3>
              <p>Plaza de la Constitución, 1</p>
              <p>41567 Herrera, Sevilla</p>
              <a
                href="https://www.herrera.sevillapueblos.com/ayuntamiento"
                target="_blank"
                class="contacto-enlace"
                >Visitar web oficial</a
              >
            </div>
          </div>

          <div class="info-section">
            <h3>Horario de atención</h3>
            <p>
              Para consultas telefónicas y por correo electrónico, nuestro
              horario de atención es:
            </p>
            <ul style="margin: 15px 0; padding-left: 20px">
              <li><strong>Lunes a viernes:</strong> 9:00 - 14:00 h</li>
              <li><strong>Tardes concertadas:</strong> 17:00 - 19:00 h</li>
            </ul>

            <h3>Asesoramiento personalizado</h3>
            <p>Ofrecemos asesoramiento personalizado para ayudarte con:</p>
            <ul style="margin: 15px 0; padding-left: 20px">
              <li>Interpretación de tu puntuación en el baremo</li>
              <li>Información sobre los cupos de adjudicación</li>
              <li>Ayuda con la documentación necesaria</li>
              <li>Seguimiento de tu posición en las listas</li>
            </ul>
          </div>
        </div>
      </div>

      <footer>
        <p>Simulador Ciudadano de Vivienda Protegida - AxSí Herrera</p>
      </footer>
    </div>

    <script>
    // Configuración de la API - AJUSTA ESTA URL
    const API_BASE = "https://jolejuma.es/fcg_axsi/api";

    // Array para almacenar todas las solicitudes de usuarios
    let todasLasSolicitudes = [];
    let solicitudUsuario = null;

    // Función para reiniciar el simulador
    function reiniciarSimulador() {
        console.log("Reiniciando simulador...");

        // Ocultar resultado
        const resultadoDiv = document.getElementById("resultado");
        if (resultadoDiv) {
            resultadoDiv.style.display = "none";
        }

        // Resetear formulario
        const formulario = document.getElementById("simulador-form");
        if (formulario) {
            formulario.reset();
        }

        // Limpiar errores
        document.querySelectorAll(".error-message").forEach((error) => {
            error.style.display = "none";
        });
        document.querySelectorAll(".input-error").forEach((input) => {
            input.classList.remove("input-error");
        });

        // Resetear solicitud del usuario
        solicitudUsuario = null;

        console.log("Simulador reiniciado correctamente");
    }

    // Función mejorada para guardar en el servidor con manejo robusto de errores
    async function guardarSolicitudServidor(solicitud) {
        try {
            console.log("Enviando solicitud al servidor...", solicitud);

            const response = await fetch(`${API_BASE}/guardar_solicitud.php`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(solicitud),
            });

            // Verificar si la respuesta está vacía
            const responseText = await response.text();

            if (!responseText) {
                console.warn("El servidor devolvió una respuesta vacía");
                return {
                    success: true,
                    message: "Datos guardados localmente (respuesta vacía del servidor)",
                };
            }

            // Intentar parsear como JSON
            let result;
            try {
                result = JSON.parse(responseText);
            } catch (parseError) {
                console.warn("La respuesta del servidor no es JSON válido:", responseText);
                return {
                    success: true,
                    message: "Datos guardados localmente (respuesta no JSON del servidor)",
                };
            }

            console.log("Respuesta del servidor:", result);

            if (!response.ok) {
                throw new Error(result.message || `Error HTTP: ${response.status}`);
            }

            if (!result.success) {
                throw new Error(result.message || "Error desconocido del servidor");
            }

            return result;
        } catch (error) {
            console.error("Error al conectar con el servidor:", error);
            throw new Error("No se pudo guardar en el servidor. Error: " + error.message);
        }
    }

    // Función mejorada para cargar desde el servidor
    async function cargarSolicitudesServidor() {
        try {
            console.log("Cargando solicitudes del servidor...");

            const response = await fetch(`${API_BASE}/obtener_solicitudes.php`);

            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }

            const responseText = await response.text();

            // Si la respuesta está vacía, devolver array vacío
            if (!responseText) {
                console.warn("El servidor devolvió una respuesta vacía");
                return [];
            }

            // Intentar parsear como JSON
            let solicitudes;
            try {
                solicitudes = JSON.parse(responseText);
            } catch (parseError) {
                console.warn("La respuesta del servidor no es JSON válido:", responseText);
                return [];
            }

            if (!Array.isArray(solicitudes)) {
                console.warn("La respuesta del servidor no es un array:", solicitudes);
                return [];
            }

            console.log("Solicitudes cargadas del servidor:", solicitudes.length);
            return solicitudes;
        } catch (error) {
            console.error("Error cargando del servidor:", error);
            throw error;
        }
    }

    // Cargar solicitudes guardadas al iniciar
    function cargarSolicitudesGuardadas() {
        try {
            let solicitudesGuardadas = localStorage.getItem("todasLasSolicitudes");
            if (solicitudesGuardadas) {
                todasLasSolicitudes = JSON.parse(solicitudesGuardadas);
                console.log("Datos locales cargados:", todasLasSolicitudes.length, "solicitudes");
            } else {
                console.log("No hay datos locales guardados");
            }
        } catch (error) {
            console.error("Error cargando datos locales:", error);
            todasLasSolicitudes = [];
        }
    }

    // Guardar todas las solicitudes localmente (backup)
    function guardarSolicitudesLocal() {
        try {
            localStorage.setItem("todasLasSolicitudes", JSON.stringify(todasLasSolicitudes));
            console.log("Datos guardados localmente:", todasLasSolicitudes.length, "solicitudes");
        } catch (error) {
            console.error("Error guardando datos locales:", error);
        }
    }

    // Inicializar la página
    document.addEventListener("DOMContentLoaded", async function () {
        console.log("Inicializando página...");

        // Inicializar navegación PRIMERO
        inicializarNavegacion();

        // Luego el resto de inicializaciones
        inicializarFAQ();
        cargarSolicitudesGuardadas();

        // Intentar cargar del servidor
        try {
            const solicitudesServidor = await cargarSolicitudesServidor();
            if (solicitudesServidor.length > 0) {
                todasLasSolicitudes = solicitudesServidor;
                guardarSolicitudesLocal(); // Backup local
                console.log("Datos cargados del servidor:", todasLasSolicitudes.length, "solicitudes");
            } else {
                console.log("Servidor no devolvió datos, manteniendo datos locales");
            }
        } catch (error) {
            console.log("Error cargando del servidor, usando datos locales:", error.message);
        }

        cargarListadosSolicitantes();
        inicializarValidaciones();

        // Agregar evento al botón calcular
        document.querySelector(".btn-calcular").addEventListener("click", calcularPuntos);

        console.log("Página inicializada correctamente");
    });

    // Inicializar navegación - CORREGIDA
    function inicializarNavegacion() {
        console.log("Inicializando navegación...");
        
        // Menú hamburguesa
        const hamburger = document.getElementById("hamburger");
        if (hamburger) {
            hamburger.addEventListener("click", function () {
                const navMenu = document.getElementById("navMenu");
                if (navMenu) {
                    navMenu.classList.toggle("active");
                    this.classList.toggle("active");
                }
            });
        }
        
        // Navegación entre secciones - CORREGIDO
        document.querySelectorAll('.nav-link[data-seccion]').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const seccionId = this.getAttribute('data-seccion');
                console.log('Navegando a:', seccionId);
                cambiarSeccion(seccionId, this);
            });
        });
        
        // Cerrar menú al hacer clic fuera de él
        document.addEventListener("click", function (e) {
            const navMenu = document.getElementById("navMenu");
            const hamburger = document.getElementById("hamburger");
            if (navMenu && hamburger && !e.target.closest(".nav-menu") && !e.target.closest(".hamburger")) {
                navMenu.classList.remove("active");
                hamburger.classList.remove("active");
            }
        });

        console.log("Navegación inicializada");
    }

    // Función para cambiar de sección - CORREGIDA
    function cambiarSeccion(seccionId, elemento) {
        console.log('Cambiando a sección:', seccionId);
        
        // Ocultar todas las secciones
        document.querySelectorAll('[id^="seccion-"]').forEach((seccion) => {
            seccion.classList.remove("seccion-activa");
        });

        // Mostrar la sección seleccionada
        const seccionDestino = document.getElementById(`seccion-${seccionId}`);
        if (seccionDestino) {
            seccionDestino.classList.add("seccion-activa");
            console.log('Sección mostrada:', `seccion-${seccionId}`);
            
            // Scroll suave al principio de la sección
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        } else {
            console.error('Sección NO encontrada:', `seccion-${seccionId}`);
            // Fallback: mostrar simulador
            document.getElementById('seccion-simulador').classList.add('seccion-activa');
        }

        // Actualizar enlace activo
        document.querySelectorAll(".nav-link").forEach((navLink) => {
            navLink.classList.remove("active");
        });
        if (elemento) {
            elemento.classList.add("active");
        }

        // Si es la sección de consulta, actualizar listados
        if (seccionId === "consulta") {
            cargarListadosSolicitantes();
        }

        // Cerrar menú en móviles
        if (window.innerWidth <= 900) {
            const navMenu = document.getElementById("navMenu");
            const hamburger = document.getElementById("hamburger");
            if (navMenu) navMenu.classList.remove("active");
            if (hamburger) hamburger.classList.remove("active");
        }
    }

    // Inicializar preguntas frecuentes
    function inicializarFAQ() {
        document.querySelectorAll(".faq-question").forEach((question) => {
            question.addEventListener("click", function () {
                const item = this.parentElement;
                item.classList.toggle("active");
            });
        });
    }

    // Validar formulario completo
    function validarFormulario() {
        const anoInscripcion = document.getElementById("ano_inscripcion").value;
        const ingresos = document.getElementById("ingresos_anuales").value;
        const edad = document.getElementById("edad").value;

        // Limpiar errores previos
        document.querySelectorAll(".error-message").forEach((error) => {
            error.style.display = "none";
        });
        document.querySelectorAll(".input-error").forEach((input) => {
            input.classList.remove("input-error");
        });

        let valido = true;

        if (!anoInscripcion || anoInscripcion < 1990 || anoInscripcion > 2024) {
            mostrarError("ano_inscripcion", "Por favor, introduce un año de inscripción válido entre 1990 y 2024");
            valido = false;
        }

        if (!ingresos || ingresos < 0 || isNaN(ingresos)) {
            mostrarError("ingresos_anuales", "Por favor, introduce unos ingresos válidos");
            valido = false;
        }

        if (!edad || edad < 18 || edad > 100 || isNaN(edad)) {
            mostrarError("edad", "La edad debe estar entre 18 y 100 años");
            valido = false;
        }

        return valido;
    }

    // Mostrar error de validación
    function mostrarError(campoId, mensaje) {
        const campo = document.getElementById(campoId);
        const errorElement = document.getElementById(`error-${campoId}`);

        if (campo) {
            campo.classList.add("input-error");
        }

        if (errorElement) {
            errorElement.textContent = mensaje;
            errorElement.style.display = "block";
        }
    }

    // FUNCIÓN PRINCIPAL MEJORADA
    async function calcularPuntos() {
        console.log("Calculando puntos...");

        if (!validarFormulario()) {
            return;
        }

        const loadingIndicator = document.getElementById("loading-indicator");
        if (loadingIndicator) {
            loadingIndicator.style.display = "block";
        }

        try {
            // Calcular puntos
            const IPREM_ANUAL = 7200.0;
            let totalPuntos = 0;

            // 1. Antigüedad
            const anoActual = new Date().getFullYear();
            const anoInscripcion = parseInt(document.getElementById("ano_inscripcion").value);
            if (!isNaN(anoInscripcion) && anoInscripcion <= anoActual) {
                const anosAntiguedad = anoActual - anoInscripcion;
                totalPuntos += Math.min(Math.max(0, anosAntiguedad), 5);
            }

            // 2. Ingresos
            const ingresos = parseFloat(document.getElementById("ingresos_anuales").value);
            if (!isNaN(ingresos)) {
                const ratioIPREM = ingresos / IPREM_ANUAL;
                if (ratioIPREM < 1.2) totalPuntos += 5;
                else if (ratioIPREM <= 2.5) totalPuntos += 3;
                else if (ratioIPREM <= 3.5) totalPuntos += 1;
            }

            // 3. Situación familiar
            const situacion = document.getElementById("situacion_familiar").value;
            if (situacion === "monoparental" || situacion === "numerosa") totalPuntos += 3;
            else if (situacion === "solo_progenitor") totalPuntos += 2;
            else if (situacion === "pareja_joven") totalPuntos += 1;

            // 4. Discapacidad
            if (document.getElementById("discapacidad").checked) totalPuntos += 3;

            // 5. Violencia de género
            if (document.getElementById("violencia_genero").checked) totalPuntos += 3;

            // 6. Edad
            const edad = parseInt(document.getElementById("edad").value);
            if (!isNaN(edad) && (edad < 35 || edad > 65)) totalPuntos += 2;

            // 7. Situación residencial
            const vivienda = document.getElementById("vivienda_actual").value;
            if (vivienda === "inadecuada") totalPuntos += 3;
            else if (vivienda === "alquiler_caro") totalPuntos += 2;

            console.log("Total puntos calculados:", totalPuntos);

            // Crear solicitud
            const cuposAplicables = determinarCuposAplicables();
            const numeroSolicitud = generarNumeroSolicitud(cuposAplicables[0], totalPuntos);

            const nuevaSolicitud = {
                numero: numeroSolicitud,
                puntos: totalPuntos,
                cupos: cuposAplicables,
                datos_usuario: {
                    ano_inscripcion: document.getElementById("ano_inscripcion").value,
                    ingresos_anuales: document.getElementById("ingresos_anuales").value,
                    edad: document.getElementById("edad").value,
                    situacion_familiar: document.getElementById("situacion_familiar").value,
                    vivienda_actual: document.getElementById("vivienda_actual").value,
                    discapacidad: document.getElementById("discapacidad").checked,
                    violencia_genero: document.getElementById("violencia_genero").checked,
                    timestamp: new Date().toISOString(),
                },
            };

            // Guardar en servidor (con manejo mejorado de errores)
            try {
                await guardarSolicitudServidor(nuevaSolicitud);
                console.log("Solicitud guardada exitosamente en el servidor");
            } catch (serverError) {
                console.warn("No se pudo guardar en el servidor, usando almacenamiento local:", serverError.message);
                // Continuamos con el almacenamiento local
            }

            // Actualizar datos locales
            solicitudUsuario = nuevaSolicitud;
            const existe = todasLasSolicitudes.find((s) => s.numero === nuevaSolicitud.numero);
            if (!existe) {
                todasLasSolicitudes.push(nuevaSolicitud);
                guardarSolicitudesLocal();
            }

            // Recargar desde servidor para tener datos actualizados (opcional)
            try {
                const solicitudesActualizadas = await cargarSolicitudesServidor();
                if (solicitudesActualizadas.length > 0) {
                    todasLasSolicitudes = solicitudesActualizadas;
                    guardarSolicitudesLocal();
                    console.log("Datos actualizados desde el servidor");
                }
            } catch (error) {
                console.log("No se pudieron actualizar los datos del servidor, usando locales");
            }

            // Mostrar resultado
            mostrarResultado(totalPuntos, numeroSolicitud);
        } catch (error) {
            console.error("Error general:", error);
            alert("Error: " + error.message + "\nLos datos se guardaron localmente.");

            // Fallback local
            if (solicitudUsuario) {
                const existe = todasLasSolicitudes.find((s) => s.numero === solicitudUsuario.numero);
                if (!existe) {
                    todasLasSolicitudes.push(solicitudUsuario);
                    guardarSolicitudesLocal();
                }
                mostrarResultado(solicitudUsuario.puntos, solicitudUsuario.numero);
            }
        } finally {
            if (loadingIndicator) {
                loadingIndicator.style.display = "none";
            }
        }
    }

    // Función para mostrar resultados
    function mostrarResultado(totalPuntos, numeroSolicitud) {
        const resultadoDiv = document.getElementById("resultado");
        if (!resultadoDiv) return;

        const puntosObtenidos = document.getElementById("puntos_obtenidos");
        if (puntosObtenidos) {
            puntosObtenidos.innerText = totalPuntos;
        }

        const mensajeP = document.getElementById("mensaje_probabilidad");
        if (mensajeP) {
            if (totalPuntos > 17) {
                mensajeP.innerText = "Probabilidad Alta";
                mensajeP.className = "mensaje-probabilidad alta";
            } else if (totalPuntos >= 12) {
                mensajeP.innerText = "Probabilidad Media";
                mensajeP.className = "mensaje-probabilidad media";
            } else {
                mensajeP.innerText = "Probabilidad Baja";
                mensajeP.className = "mensaje-probabilidad baja";
            }
        }

        mostrarPosicionCupos(totalPuntos);
        resultadoDiv.style.display = "block";
        cargarListadosSolicitantes();
        mostrarInfoSolicitud(numeroSolicitud);
    }

    function mostrarInfoSolicitud(numeroSolicitud) {
        // Eliminar info anterior si existe
        const infoAnterior = document.querySelector(".info-solicitud");
        if (infoAnterior) infoAnterior.remove();

        const infoDiv = document.createElement("div");
        infoDiv.className = "advertencia-consulta info-solicitud";
        infoDiv.style.marginTop = "20px";
        infoDiv.innerHTML = `
            <h4><i class="fas fa-info-circle"></i> Tu número de solicitud</h4>
            <p>Se ha generado tu número de solicitud: <strong>${numeroSolicitud}</strong></p>
            <p>Guarda este número para consultar tu posición en los listados. Recuerda que esta información es orientativa.</p>
        `;

        const resultadoDiv = document.getElementById("resultado");
        if (resultadoDiv) {
            resultadoDiv.appendChild(infoDiv);
        }
    }

    function generarNumeroSolicitud(cupoPrincipal, puntos) {
        const prefijos = {
            "Discapacidad/movilidad reducida": "DIS",
            "Jóvenes (<35 años)": "JOV",
            "Familias numerosas/monoparentales": "FAM",
            "Mayores de 65 años": "MAY",
            "Violencia de género/terrorismo": "VG",
            "Régimen general": "GEN",
        };
        const prefijo = prefijos[cupoPrincipal] || "SOL";
        const numero = puntos * 10 + Math.floor(Math.random() * 10);
        return `${prefijo}-${numero.toString().padStart(3, "0")}`;
    }

    function determinarCuposAplicables() {
        const cupos = ["Régimen general"];
        const edad = parseInt(document.getElementById("edad").value);
        if (!isNaN(edad)) {
            if (edad < 35) {
                cupos.push("Jóvenes (<35 años)");
            } else if (edad > 65) {
                cupos.push("Mayores de 65 años");
            }
        }
        const situacion = document.getElementById("situacion_familiar").value;
        if (situacion === "monoparental" || situacion === "numerosa" || situacion === "solo_progenitor") {
            cupos.push("Familias numerosas/monoparentales");
        }
        if (document.getElementById("discapacidad").checked) {
            cupos.push("Discapacidad/movilidad reducida");
        }
        if (document.getElementById("violencia_genero").checked) {
            cupos.push("Violencia de género/terrorismo");
        }
        return cupos;
    }

    // FUNCIÓN MEJORADA PARA CARGAR LISTADOS DE SOLICITANTES
    function cargarListadosSolicitantes() {
        console.log("Cargando listados de solicitantes...");

        cargarListadoCupo("Discapacidad/movilidad reducida", "lista-discapacidad");
        cargarListadoCupo("Jóvenes (<35 años)", "lista-jovenes");
        cargarListadoCupo("Familias numerosas/monoparentales", "lista-familias");
        cargarListadoCupo("Mayores de 65 años", "lista-mayores");
        cargarListadoCupo("Violencia de género/terrorismo", "lista-violencia");
        cargarListadoCupo("Régimen general", "lista-general");

        console.log("Listados de solicitantes cargados correctamente");
    }

    function cargarListadoCupo(cupo, elementoId) {
        const lista = document.getElementById(elementoId);
        if (!lista) {
            console.warn(`Elemento ${elementoId} no encontrado`);
            return;
        }

        const solicitantesDelCupo = todasLasSolicitudes
            .filter((solicitud) => solicitud.cupos && solicitud.cupos.includes(cupo))
            .sort((a, b) => b.puntos - a.puntos);

        lista.innerHTML = "";

        if (solicitantesDelCupo.length === 0) {
            lista.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--texto-medio);">No hay solicitudes en este cupo</div>';
            return;
        }

        solicitantesDelCupo.forEach((solicitante, index) => {
            const item = document.createElement("div");
            item.className = "solicitante-item";
            if (solicitudUsuario && solicitante.numero === solicitudUsuario.numero) {
                item.classList.add("solicitante-usuario");
            }
            item.innerHTML = `
                <div class="solicitante-numero">${solicitante.numero || "N/D"}</div>
                <div>Solicitud ${index + 1}º</div>
                <div class="solicitante-puntos">${solicitante.puntos || 0} puntos</div>
            `;
            lista.appendChild(item);
        });

        console.log(`Cupo ${cupo}: ${solicitantesDelCupo.length} solicitantes cargados`);
    }

    function mostrarPosicionCupos(puntosUsuario) {
        const listaPosiciones = document.getElementById("lista-posiciones");
        const cupoPosicionDiv = document.getElementById("cupo-posicion");

        if (!listaPosiciones || !cupoPosicionDiv) return;

        listaPosiciones.innerHTML = "";

        const cuposAplicables = determinarCuposAplicables();
        cuposAplicables.forEach((cupo) => {
            const solicitantesDelCupo = todasLasSolicitudes
                .filter((s) => s.cupos && s.cupos.includes(cupo))
                .sort((a, b) => b.puntos - a.puntos);

            const posicion = calcularPosicion(puntosUsuario, solicitantesDelCupo);
            const item = document.createElement("div");
            item.className = "posicion-item";
            item.innerHTML = `
                <div class="posicion-cupo">${cupo}</div>
                <div class="posicion-datos">
                    <span class="posicion-puntos">${puntosUsuario} puntos</span>
                    <div class="posicion-numero">Solicitante ${posicion} de ${solicitantesDelCupo.length}</div>
                </div>
            `;
            listaPosiciones.appendChild(item);
        });

        cupoPosicionDiv.style.display = "block";
    }

    function calcularPosicion(puntosUsuario, solicitantesCupo) {
        const puntosOrdenados = [...solicitantesCupo].sort((a, b) => b.puntos - a.puntos);
        for (let i = 0; i < puntosOrdenados.length; i++) {
            if (puntosUsuario >= puntosOrdenados[i].puntos) {
                return i + 1;
            }
        }
        return puntosOrdenados.length + 1;
    }

    function inicializarValidaciones() {
        const camposRequeridos = ["ano_inscripcion", "ingresos_anuales", "edad"];

        camposRequeridos.forEach((campoId) => {
            const campo = document.getElementById(campoId);
            if (campo) {
                campo.addEventListener("blur", function () {
                    validarCampo(this);
                });
            }
        });
    }

    function validarCampo(campo) {
        const valor = campo.value.trim();
        const errorElement = document.getElementById(`error-${campo.id}`);

        if (campo) {
            campo.classList.remove("input-error");
        }

        if (errorElement) {
            errorElement.style.display = "none";
        }

        if (campo.id === "ano_inscripcion") {
            const anoActual = new Date().getFullYear();
            if (!valor || isNaN(valor) || valor < 1990 || valor > anoActual) {
                mostrarError(campo.id, "Por favor, introduce un año válido entre 1990 y " + anoActual);
                return false;
            }
        } else if (campo.id === "ingresos_anuales") {
            if (!valor || isNaN(valor) || valor < 0) {
                mostrarError(campo.id, "Por favor, introduce unos ingresos válidos");
                return false;
            }
        } else if (campo.id === "edad") {
            if (!valor || isNaN(valor) || valor < 18 || valor > 100) {
                mostrarError(campo.id, "La edad debe estar entre 18 y 100 años");
                return false;
            }
        }

        return true;
    }

    // Protección contra cierre accidental
    window.addEventListener("beforeunload", function (e) {
        if (todasLasSolicitudes.length > 0) {
            e.preventDefault();
            e.returnValue = "";
        }
    });
</script>
  </body>
</html>
